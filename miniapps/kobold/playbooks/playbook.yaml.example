---
globals:
  import: ./import
jobs:
  - job: device_tags
    description: set device tag
    devices:
      sql:
        select: name
        from: nb.devices
        where: location=default-site and name__ic=local
    tasks:
      - set_tag:
        scope: dcim.device
        tag: test

  - job: interface_tags
    description: set interface tag
    devices:
      sql:
        select: name, interfaces
        from: nb.devices
        where: name__ic=local and interfaces_name__ic=GigabitEthernet
    tasks:
      - delete_tag:
        scope: dcim.interface
        tag: dhcp

  - job: device_cf_field
    description: set custom field on device
    devices:
      sql:
        select: name, interfaces
        from: nb.devices
        where: name=eins.local
    tasks:
      - custom_field:
        - net: eins
          scope: dcim.device

  - job: interface_cf_field
    description: set interface custom field
    devices:
      sql:
        select: name, interfaces
        from: nb.devices
        where: name__ic=local and interfaces_name__ic=GigabitEthernet
    tasks:
      - custom_field:
        - iface_field: test
          scope: dcim.interface

  - job: update_device
    description: update device
    devices:
      sql:
        select: name, interfaces
        from: nb.devices
        where: name=eins.local
    tasks:
      - update_device:
          serial: 12345

  - job: update_interface
    description: update interface
    devices:
      sql:
        select: name, interfaces
        from: nb.devices
        where: name__ic=local and interfaces_name__ic=GigabitEthernet
    tasks:
      - update_interface:
          description: mydescr

  - job: export_properties
    description: export properties
    devices:
      sql:
        select: id, name, primary_ip4, interfaces, location, cf_net, cf_select
        from: nb.devices
        where: name__ic=local
    tasks:
      - export: 
        - content: properties
          header: True
          columns: id, name, primary_ip4.address, primary_ip4.interfaces.name, checksum
          # columns: name, primary_ip4.address, interfaces.name, interfaces.ip_addresses.address, checksum
          # columns: interfaces.name, interfaces.description
          # columns: id, name, location.name, cf_net,cf_select, checksum
          # columns: name, interfaces.id, interfaces.name, interfaces.description,checksum
          format: excel
          delimiter: ","
          quotechar: "|"
          quoting: minimal
          filename: ./export/properties.xlsx

  - job: export_config
    description: export configs, facts and properties
    devices:
      sql:
        select: id, name, platform, primary_ip4
        from: nb.devices
        where: name=eins.local
    tasks:
      - export: 
        # content can be either config, facts, hldm or properties
        - content: config, facts
          directory: configs
          filename: __name__.json

  - job: export_hldm
    description: export HLDM
    devices:
      sql:
        select: name,cf_net,location
        from: nb.devices
        where: name=eins.local
    tasks:
      - export: 
        # content can be either config, facts, hldm or properties
        - content: hldm
          directory: hldm/__cf_net__/__location_name__
          filename: __name__.json

